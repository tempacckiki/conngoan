<?php 

header("Content-type: application/vnd.ms-excel"); 
header("Content-Disposition: attachment; filename=Thong-ke-don-hang.xls"); 
header("Pragma: no-cache"); 
header("Expires: 0");
?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html xmlns:v="urn:schemas-microsoft-com:vml"xmlns:o="urn:schemas-microsoft-com:office:office"xmlns:x="urn:schemas-microsoft-com:office:excel"xmlns="http://www.w3.org/TR/REChtml40">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style>
@page{
    margin:0.5in .5in .5in .5in;
}
 td {
    padding-top: 1px;
}
tr {
}
col {
}
br {
}
.style0 {
    border: medium none;
    color: black;
    font-family: Calibri,sans-serif;
    font-size: 11pt;
    font-style: normal;
    font-weight: 400;
    text-decoration: none;
    vertical-align: bottom;
    white-space: nowrap;
}
td {
    border: medium none;
    color: black;
    font-family: Calibri,sans-serif;
    font-size: 11pt;
    font-style: normal;
    font-weight: 400;
    padding-left: 1px;
    padding-right: 1px;
    padding-top: 1px;
    text-decoration: none;
    vertical-align: bottom;
    white-space: nowrap;
}
.xl65 {
    text-align: center;
    vertical-align: middle;
}
.xl66 {
    background: none repeat scroll 0 0 #00B0F0;
    border: 0.5pt solid windowtext;
    color: white;
    font-family: Tahoma,sans-serif;
    font-size: 10pt;
    font-weight: 700;
    text-align: center;
    vertical-align: middle;
}
.xl67 {
    background: none repeat scroll 0 0 #00B0F0;
    border-color: windowtext windowtext windowtext -moz-use-text-color;
    border-style: solid solid solid none;
    border-width: 0.5pt 0.5pt 0.5pt medium;
    color: white;
    font-family: Tahoma,sans-serif;
    font-size: 10pt;
    font-weight: 700;
    text-align: center;
    vertical-align: middle;
}
.xl68 {
    border-color: -moz-use-text-color windowtext windowtext;
    border-style: none solid solid;
    border-width: medium 0.5pt 0.5pt;
    color: black;
    font-family: Tahoma,sans-serif;
    font-size: 10pt;
    text-align: center;
    vertical-align: middle;
}
.xl69 {
    border-color: -moz-use-text-color windowtext windowtext -moz-use-text-color;
    border-style: none solid solid none;
    border-width: medium 0.5pt 0.5pt medium;
    color: black;
    font-family: Tahoma,sans-serif;
    font-size: 10pt;
    text-align: left;
    vertical-align: middle;
}
.xl70 {
    border-color: -moz-use-text-color windowtext windowtext -moz-use-text-color;
    border-style: none solid solid none;
    border-width: medium 0.5pt 0.5pt medium;
    color: black;
    font-family: Tahoma,sans-serif;
    font-size: 10pt;
    text-align: center;
    vertical-align: middle;
}
.xl71 {
    border-color: -moz-use-text-color windowtext windowtext -moz-use-text-color;
    border-style: none solid solid none;
    border-width: medium 0.5pt 0.5pt medium;
    color: black;
    font-family: Tahoma,sans-serif;
    font-size: 10pt;
    text-align: right;
    vertical-align: middle;
}
.xl72 {
    border-color: -moz-use-text-color windowtext windowtext -moz-use-text-color;
    border-style: none solid solid none;
    border-width: medium 0.5pt 0.5pt medium;
    color: black;
    font-family: Tahoma,sans-serif;
    font-size: 10pt;
    text-align: center;
    vertical-align: middle;
}
.xl73 {
    border-color: -moz-use-text-color -moz-use-text-color windowtext;
    border-style: none none solid;
    border-width: medium medium 0.5pt;
    color: black;
    font-family: Tahoma,sans-serif;
    font-size: 12pt;
    font-weight: 700;
    text-align: center;
    vertical-align: middle;
}
.xl74 {
    border-color: windowtext -moz-use-text-color black black;
    border-style: solid none solid solid;
    border-width: 0.5pt medium 0.5pt 0.5pt;
    color: black;
    font-family: Tahoma,sans-serif;
    font-size: 10pt;
    font-weight: 700;
    text-align: right;
    vertical-align: middle;
}
.xl75 {
    border-color: windowtext -moz-use-text-color black;
    border-style: solid none;
    border-width: 0.5pt medium;
    color: black;
    font-family: Tahoma,sans-serif;
    font-size: 10pt;
    font-weight: 700;
    text-align: right;
    vertical-align: middle;
}
.xl76 {
    border-color: windowtext black black -moz-use-text-color;
    border-style: solid solid solid none;
    border-width: 0.5pt 0.5pt 0.5pt medium;
    color: black;
    font-family: Tahoma,sans-serif;
    font-size: 10pt;
    font-weight: 700;
    text-align: right;
    vertical-align: middle;
}
.xl77 {
    border-color: -moz-use-text-color windowtext windowtext -moz-use-text-color;
    border-style: none solid solid none;
    border-width: medium 0.5pt 0.5pt medium;
    color: red;
    font-family: Tahoma,sans-serif;
    font-size: 10pt;
    font-weight: 700;
    text-align: right;
    vertical-align: middle;
}
</style>
</head>
<body vlink="purple" link="blue" class="xl65">
<table width="1243" cellspacing="0" cellpadding="0" border="0" style="border-collapse:collapse;table-layout:fixed;width:934pt">
    <colgroup>
        <col width="37" style="mso-width-source:userset;mso-width-alt:1353;width:28pt" class="xl65">
        <col width="152" style="mso-width-source:userset;mso-width-alt:5558;width:114pt" class="xl65">
        <col width="81" span="2" style="mso-width-source:userset;mso-width-alt:2962;width:70pt" class="xl65">
        <col width="103" style="mso-width-source:userset;mso-width-alt:3766;width:77pt" class="xl65">
        <col width="311" style="mso-width-source:userset;mso-width-alt:11373;width:233pt" class="xl65">
        <col width="174" style="mso-width-source:userset;mso-width-alt:6363;width:131pt" class="xl65">
        <col width="37" style="mso-width-source:userset;mso-width-alt:1353;width:28pt" class="xl65">
        <col width="89" span="3" style="mso-width-source:userset;mso-width-alt:3254;width:67pt" class="xl65">
    </colgroup>
    <tbody>
    <tr height="46" style="mso-height-source:userset;height:34.5pt">
        <td width="1154" height="46" style="height:34.5pt;width:867pt" class="xl73" colspan="10">THỐNG KÊ ĐƠN HÀNG</td>
        <td width="89" style="width:67pt" class="xl65"></td>
    </tr>
    <tr height="26" style="mso-height-source:userset;height:20.1pt">
        <td height="26" style="height:20.1pt;border-top:none" class="xl66">STT</td>
        <td style="border-top:none" class="xl67">Khách hàng</td>
        <td style="border-top:none" class="xl67">Tình trang</td>
        <td style="border-top:none" class="xl67">Ngày mua</td>
        <td style="border-top:none" class="xl67">NVKD</td>
        <td style="border-top:none" class="xl67">Tên sản phẩm</td>
        <td style="border-top:none" class="xl67">Danh mục</td>
        <td style="border-top:none" class="xl67">SL</td>
        <td style="border-top:none" class="xl67">Đơn giá</td>
        <td style="border-top:none" class="xl67">Thành tiền</td>
        <td class="xl67">Tổng</td>
    </tr>
    <?
    $i = 1;
    $tong = 0;
    foreach($list as $rs):
    $list_product = $this->thongke->get_all_order_detail($rs->order_id, $catid);
    if(count($list_product) > 0){
        $tong = $tong + $rs->total;
    ?>
    <tr height="24" style="mso-height-source:userset;height:18.0pt">
        <td height="24" style="height:18.0pt" class="xl68"><?=$i?></td>
        <td class="xl69"><?=$rs->fullname?></td>
        <td class="xl70" style="text-align: left;"><?=get_status($rs->status)?></td>
        <td class="xl70"><?=date('d/m/Y',$rs->date_buy)?></td>
        <td class="xl70">
            <?
            $user = $this->thongke->get_user($rs->employee_id);
            echo ($user)?$user->fullname:'';
            $this->db = $this->load->database('default', TRUE);
            ?>
        </td>
        <td class="xl69">
            <?
            $total = count($list_product);
            $j = 0;
            foreach($list_product as $val):?>
                <?=$val->productname?> <?=($j < $total)?'<br />':''?>
            <?
            $j++;
            endforeach;?>
        </td>
        <td class="xl69">
            <?
            $total = count($list_product);
            $j = 0;
            foreach($list_product as $val):
            ?>
                <?
                $cat  = $this->vdb->find_by_id('shop_cat',array('catid'=>$val->catid));
                if($cat){echo $cat->catname;}
                
                ?>
                <?=($j < $total)?'<br />':''?>
            <?
            $j++;
            endforeach;?>
        </td>
        <td class="xl70">
            <?
            $total = count($list_product);
            $j = 0;
            foreach($list_product as $val):
            ?>
                <?=$val->s_qty?> <?=($j < $total)?'<br />':''?>
            <?
            $j++;
            endforeach;?>
        </td>
        <td class="xl71">
            <?
            $total = count($list_product);
            $j = 0;
            foreach($list_product as $val):?>
                <?=number_format($val->s_price,0,',',',')?> <?=($j < $total)?'<br />':''?>
            <?
            $j++;
            endforeach;?>
        </td>
        <td class="xl72">
            <?
            $total = count($list_product);
            $j = 0;
            foreach($list_product as $val):?>
                <?=number_format($val->s_price * $val->s_qty,0,',',',')?> <?=($j < $total)?'<br />':''?>
            <?
            $j++;
            endforeach;?>
        </td>
        <td class="xl77"><?=number_format($rs->total,0,',',',')?></td>
    </tr>
    <?
    $i++;
    }
    endforeach;?>
    <tr height="29" style="mso-height-source:userset;height:21.75pt">
        <td height="29" style="border-right:.5pt solid black; height:21.75pt" class="xl74" colspan="10">Tổng</td>
        <td class="xl77"><?=number_format($tong,0,',',',')?></td>
    </tr>
    <!--[if supportMisalignedColumns]-->
    <tr height="0" style="display:none">
        <td width="37" style="width:28pt"></td>
        <td width="152" style="width:114pt"></td>
        <td width="81" style="width:61pt"></td>
        <td width="81" style="width:61pt"></td>
        <td width="103" style="width:77pt"></td>
        <td width="311" style="width:233pt"></td>
        <td width="174" style="width:131pt"></td>
        <td width="37" style="width:28pt"></td>
        <td width="89" style="width:67pt"></td>
        <td width="89" style="width:67pt"></td>
        <td width="89" style="width:67pt"></td>
    </tr>
    <!--[endif]-->
    </tbody>
</table>

</body>
</html>
